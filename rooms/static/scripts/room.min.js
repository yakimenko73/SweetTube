!function(){const e=JSON.parse(document.getElementById("room-name").textContent),t=JSON.parse(document.getElementById("room-permissions").textContent),n=JSON.parse(document.getElementById("user-nickname").textContent),l=JSON.parse(document.getElementById("user-sessionid").textContent),i=JSON.parse(document.getElementById("user-color").textContent),o=JSON.parse(document.getElementById("user-status").textContent);if("1"===localStorage.getItem(e)){let e=new XMLHttpRequest;e.open("POST",window.location,!1);let t="alreadyInTheRoom";e.send(t),document.head.innerHTML=e.responseText,document.body.innerHTML=e.responseText}else{var a;const N=new WebSocket("ws://"+window.location.host+"/ws/chat/"+e+"/");function s(e){e.target.mute(),N.send(JSON.stringify({type:"get_player_config"})),setInterval(()=>N.send(JSON.stringify({type:"update_player_state",state:a.getPlayerState(),time:a.getCurrentTime()})),"GU"==o?5e3:1e3)}function c(e){let n=e.target.getCurrentTime(),i=e.target.getDuration();switch(e.data){case 1:if(0!=n)if("1"!=localStorage.getItem("isCallingPlayPauseVideo"))switch(o){case"HO":N.send(JSON.stringify({type:"play/pause",sender:l,side:"play",time:n}));break;case"MO":t.moder_can_playpause?N.send(JSON.stringify({type:"play/pause",sender:l,side:"play",time:n})):(localStorage.setItem("isCallingPlayPauseVideo",1),N.send(JSON.stringify({type:"get_player_config"})));break;case"GU":t.guest_can_playpause?N.send(JSON.stringify({type:"play/pause",sender:l,side:"play",time:n})):(localStorage.setItem("isCallingPlayPauseVideo",1),N.send(JSON.stringify({type:"get_player_config"})))}else localStorage.removeItem("isCallingPlayPauseVideo");break;case 2:if(i-n!=0)if("1"!=localStorage.getItem("isCallingPlayPauseVideo"))switch(o){case"HO":N.send(JSON.stringify({type:"play/pause",sender:l,side:"pause",time:n}));break;case"MO":t.moder_can_playpause?N.send(JSON.stringify({type:"play/pause",sender:l,side:"pause",time:n})):(localStorage.setItem("isCallingPlayPauseVideo",1),e.target.playVideo());break;case"GU":t.guest_can_playpause?N.send(JSON.stringify({type:"play/pause",sender:l,side:"pause",time:n})):(localStorage.setItem("isCallingPlayPauseVideo",1),e.target.playVideo())}else localStorage.removeItem("isCallingPlayPauseVideo");break;case 0:N.send(JSON.stringify({type:"video_ended"}));break;case-1:localStorage.removeItem("isCallingPlayPauseVideo")}}function d(e){alert(e.data),e.data}function r(e=null,t=null,n=null){switch(t){case"start":localStorage.setItem("isCallingPlayPauseVideo",1),g("novideo","visible"),a=new YT.Player("player",{height:"360",width:"640",videoId:e,host:"https://www.youtube-nocookie.com",playerVars:{autoplay:1,start:0,controls:1,disablekb:1,enablejsapi:1,iv_load_policy:3,origin:"http://127.0.0.1:8000/",playsinline:1},events:{onReady:s,onStateChange:c,onError:d}});break;case"pause":localStorage.setItem("isCallingPlayPauseVideo",1),a.pauseVideo(),a.seekTo(n);break;case"play":localStorage.setItem("isCallingPlayPauseVideo",1),a.seekTo(n),a.playVideo()}}function u(){let e=document.querySelector("#search_input"),t=e.value;e.value="";let l=I(t);N.send(JSON.stringify({type:"new_video",userNickname:n,videoURL:t,videoTitle:l[1]}))}function m(e,t=null,n=null){let l=0,i=[["color: rgb(100, 100, 100)"],[`font-weight: bold; color: ${t}`,"color: rgb(180, 180, 180)"]],o=[[e],[n,`: ${e}`]],a=document.getElementById("chat_log"),s=document.createElement("li");if(null!=e){null!=n&&(l=1);for(let e=0;e<o[l].length;e++){let t=p(i[l][e],o[l][e]);s.appendChild(t)}a.appendChild(s),a.scrollTop=a.scrollHeight}}function p(e,t){let n=document.createElement("span");return n.style=e,n.textContent=t,n}function y(e,t){document.getElementById(e).classList.add(t)}function g(e,t){let n=document.getElementById(e);n.classList.contains(t)&&n.classList.remove(t)}function _(){g("overlay","overlay_visible"),g("settings_tab","settings_visible")}function v(){y("overlay","overlay_visible"),y("settings_tab","settings_visible")}function f(){b(),y("btnPlaylist","tab_selected"),y("video_playlist","tab_visible");let e=document.getElementById("btnPlaylist").children[0];e.classList.remove("visible"),e.textContent=0}function h(){b(),y("btnChat","tab_selected"),y("chat_tab","tab_visible");let e=document.getElementById("btnChat").children[0];e.classList.remove("visible"),e.textContent=0}function b(){g("btnPlaylist","tab_selected"),g("video_playlist","tab_visible"),g("btnChat","tab_selected"),g("chat_tab","tab_visible"),g("btnSettings","tab_selected")}function S(e,t=null){null==t?!function(e){return!!document.getElementById(e).classList.contains("checked")}(e)?y(e,"checked"):g(e,"checked"):t?y(e,"checked"):g(e,"checked")}function k(e){if(function(e){return document.getElementById("main_nav")==e}(e))return;null!=document.getElementById("main_nav")&&document.getElementById("main_nav").remove(),document.querySelector(`.${e}`).insertAdjacentHTML("beforeend",'<nav class="tabs noselect" id="main_nav">\n\t\t\t\t<div class="nohide" t="playlist" id="btnPlaylist">\n\t\t\t\t\tPlaylist\n\t\t\t\t\t<div class="notify" val="0">0</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="nohide tab_selected" t="chat" id="btnChat">\n\t\t\t\t\tChat\n\t\t\t\t\t<div class="notify" val="0">0</div>\n\t\t\t\t</div>\n\t\t\t\t<div id="btnSettings">Settings</div>')}function C(){k(document.documentElement.clientWidth>977?"header":"center"),document.querySelector("#btnPlaylist").onclick=function(){f()},document.querySelector("#btnChat").onclick=function(){h()},document.querySelector("#btnSettings").onclick=function(){v()},document.querySelector("#btnCloseOverlay").onclick=function(){_()},document.querySelector("#overlay").onclick=function(){_()}}function I(e){let t=new XMLHttpRequest;t.open("GET","https://noembed.com/embed?url="+e,!1),t.send();let n=JSON.parse(t.response),l=[];return l.push(w(e)),l.push(n.title),l.push(n.author_name),l}function E(e,t){try{if(e.match(t).length>0)return!0}catch(e){return!1}}function w(e){let t=e.split("v=")[1];t||(t=e.split("be/")[1]);let n=t.indexOf("&");return-1!=n&&(t=t.substring(0,n)),t}N.onmessage=function(e){const n=JSON.parse(e.data);let i="";switch(n.type){case"chat_message":m(n.message,n.color,n.author);let c=document.getElementById("btnChat");if("nohide"==c.className){let e=c.children[0],t=parseInt(e.textContent)+1;e.textContent="+"+t,e.className+=" visible"}break;case"update_user_counter":switch(n.flag){case"left":i=n.userNickname+" left the room";break;case"join":i=n.userNickname+" joined the room"}m(i),function(e=0){let t=document.getElementById("user-counter"),n=e;n<0&&(n=0);t.textContent=n}(n.value);break;case"update_user_list":!function(e,t,n,l=!0){if(!l)return void document.getElementById(e).remove();let i=document.getElementById("user_list"),o=document.createElement("li"),a=document.createElement("div");document.getElementById(e)||(o.appendChild(a),i.appendChild(o),o.id=e,function(e,t){document.getElementById(e).style=`border-right: 5px solid ${t}`}(o.id,n),y(o.id,"user"),a.id=`${e}_name`,a.style="font-weight: bold;",a.textContent=t,y(a.id,"name"))}(n.userId,n.userNickname,n.userColor,n.isAdd);break;case"new_video":if(videoId=w(n.videoURL),null!=a){try{var s=a.getPlayerState()}catch(e){s=1}if(0!=s){!function(e,n,i){g("noplaylist","visible"),function(e,n,i){let a=e,s=document.querySelector("#video_list"),c=document.createElement("img");c.src=`https://img.youtube.com/vi/${n}/mqdefault.jpg`,c.height=94;let d=document.createElement("div");d.className="title",d.textContent=i;let r=document.createElement("div");r.className="info",r.textContent=`Added by ${a}`;let u=document.createElement("div");u.className="thumbnail",u.appendChild(c);let m=document.createElement("div");m.className="desc",m.appendChild(d),m.appendChild(r);let p=document.createElement("li");p.id=n,p.appendChild(u),p.appendChild(m),y=p,(("MO"==o?t.moder_can_remove:t.guest_can_remove)||"HO"==o)&&(y.addEventListener("mouseenter",function(){!function(e){e.insertAdjacentHTML("beforeend","<div class='playlist_video_options' style= 'display: block'>\n\t\t\t\t<div class= 'playlist_options_left' style= 'display: block'>\n\t\t\t\t\t<div class = 'playlist_btn_up playlist_btn_arrow'></div>\n\t\t\t\t\t<div class = 'playlist_btn_down playlist_btn_arrow'></div>\n\t\t\t\t</div>\n\t\t\t\t<div class = 'playlist_btn_remove' style= 'display:block'>Remove</div>\n\t\t\t</div"),e.lastElementChild.lastElementChild.addEventListener("click",function(){!function(e){let t=function(e){let t=document.getElementById("video_list"),n=0;for(let l=0;l<t.children.length;l++)if(n++,t.children[l]===e)return n}(e);N.send(JSON.stringify({type:"delete_video",videoIndex:t,sender:l})),e.remove()}(e)})}(y)}),y.addEventListener("mouseleave",function(){!function(e){e.removeChild(e.lastElementChild)}(y)})),s.appendChild(p);var y}(e,n,i),g("search_result_wrapper","visible")}(n.userNickname,videoId,n.videoTitle);let e=document.getElementById("btnPlaylist");if("nohide"==e.className){let t=e.children[0],n=parseInt(t.textContent)+1;t.textContent="+"+n,t.className+=" visible"}}else a.loadVideoById(videoId,0),document.getElementById("videoTitle").textContent=n.videoTitle}else r(videoId=videoId,flag="start"),document.getElementById("videoTitle").textContent=n.videoTitle;break;case"next_video":let d=document.getElementById("video_list"),u=d.firstChild;if(u){let e=u.id,t=u.children[1].children[0].textContent;if(u.remove(),a.loadVideoById(e,0),document.getElementById("videoTitle").textContent=t,!d.children.length){document.getElementById("noplaylist").className+=" visible"}}break;case"delete_video":let p=document.getElementById("video_list");if(n.sender!=l){p.children[n.videoIndex-1].remove()}if(!p.children.length){document.getElementById("noplaylist").className+=" visible"}break;case"play/pause":flag="pause"===n.side?"pause":"play",n.sender!=l&&r(videoId=null,flag=flag,seconds=n.time);break;case"set_player_config":state="2"===n.state?"pause":"play",r(videoId=null,flag=state,seconds=n.current_time)}},N.onopen=function(t){localStorage.setItem(e,1)},N.onclose=function(t){localStorage.setItem(e,0)},window.onbeforeunload=function(){N.close()},window.onunload=function(){N.close()},C(),function(){let e=["g","m"],t=["add","remove","move","play","seek","skip","chat","kick"];for(let n=0;n<e.length;n++)for(let l=0;l<t.length;l++){let i=`${e[n]}_${t[l]}`;document.querySelector(`#${i}`).onclick=function(){S(i)}}document.querySelector("#cb_p").onclick=function(){S("cb_p")},document.querySelector("#cb_rn").onclick=function(){S("cb_rn")}}(),function(){if("HO"!=o){let e="MO"==o?t.moder_can_add:t.guest_can_add,n="MO"==o?t.moder_can_use_chat:t.guest_can_use_chat;e||(document.getElementById("search_input").disabled=1),n||(document.getElementById("chat_input").disabled=1)}}(),window.addEventListener("resize",e=>{C()}),document.querySelector("#chat_input").onkeyup=function(e){if(13===e.keyCode){const e=document.querySelector("#chat_input"),t=e.value;if(function(e){let t=/^\s*$/;if(null==e)return!0;try{if(e.match(t).length>0)return!0}catch(e){return!1}}(t))return void(e.value=null);N.send(JSON.stringify({type:"chat_message",message:t,author:n,color:i})),e.value=""}},document.querySelector("#search_input").oninput=function(){const e=document.querySelector("#search_input").value;if(E(e,/^https:\/\/(www\.youtube\.com\/watch\?v=|youtu\.be\/).*$/)){let i=I(e);const o=e=>null==e;if(i.some(o))return;t=i[0],n=i[2],l=i[1],document.querySelector(".search_result").id=t,document.querySelector("#preview_img").src=`https://img.youtube.com/vi/${t}/mqdefault.jpg`,document.querySelector(".title").textContent=l,document.querySelector(".channel").textContent=n,y("search_result_wrapper","visible"),document.querySelector(".search_result_wrapper").style="display: block"}else g("search_result_wrapper","visible"),document.querySelector(".search_result_wrapper").style="display: none";var t,n,l},document.querySelector("#btnPlaylist").onclick=function(){f()},document.querySelector("#btnChat").onclick=function(){h()},document.querySelector("#btnSettings").onclick=function(){v()},document.querySelector("#search_input").onfocus=function(){E(document.querySelector("#search_input").value,/^https:\/\/www\.youtube\.com\/watch\?v=\w{11}$/)&&y("search_result_wrapper","visible")},document.querySelector("#search_input").onblur=function(){g("search_result_wrapper","visible")},document.querySelector("#search_result_wrapper").onclick=function(){u()},document.querySelector("#search_input").onkeyup=function(e){13==e.keyCode&&u()},document.querySelector("#color_picker").onclick=function(){document.getElementById("color_picker_popup").classList.contains("color_picker_popup_visible")?g("color_picker_popup","color_picker_popup_visible"):y("color_picker_popup","color_picker_popup_visible")}}}();